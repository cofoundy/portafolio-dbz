---
import SEO from '../components/layout/SEO.astro';
import { Image } from 'astro:assets';
import '../styles/global.css';
import logoCofoundy from '../assets/images/logos/cofoundy-white.svg';


interface Props {
  title: string;
  description: string;
  image?: string;
}

const { title, description, image } = Astro.props;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/favicon.ico" sizes="32x32" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <SEO title={title} description={description} image={image} />
    <!-- Plausible Analytics — descomentar cuando se defina dominio
    <script defer data-domain="danielbonifaz.com" src="https://plausible.io/js/script.js"></script>
    -->
    <script is:inline>
      (function() {
        var saved = localStorage.getItem('theme');
        var theme = saved || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>
  <body class="min-h-screen">
    <!-- FAB flotante — solo móvil -->
    <div id="mobile-fab" class="fixed bottom-20 right-6 z-50 h-12 w-12 overflow-visible md:hidden">
      <!-- Satélite arriba: ir al inicio (Lucide arrow-up) -->
      <button id="fab-top" class="fab-satellite absolute top-0 left-0 grid h-12 w-12 place-items-center rounded-full bg-brand-800 border border-brand-700 text-brand-300 shadow-lg hover:text-brand-50" aria-label="Ir arriba">
        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m5 12 7-7 7 7M12 19V5" />
        </svg>
      </button>
      <!-- Satélite izquierda: cerrar secciones (Lucide minimize-2) -->
      <button id="fab-left" class="fab-satellite absolute top-0 left-0 grid h-12 w-12 place-items-center rounded-full bg-brand-800 border border-brand-700 text-brand-300 shadow-lg hover:text-brand-50" aria-label="Cerrar secciones">
        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 3v3a2 2 0 0 1-2 2H3M21 8h-3a2 2 0 0 1-2-2V3M3 16h3a2 2 0 0 1 2 2v3M16 21v-3a2 2 0 0 1 2-2h3" />
        </svg>
      </button>
      <!-- Satélite abajo: cambiar tema (Lucide sun) -->
      <button id="fab-bottom" class="fab-satellite absolute top-0 left-0 grid h-12 w-12 place-items-center rounded-full bg-brand-800 border border-brand-700 text-brand-300 shadow-lg hover:text-brand-50" aria-label="Cambiar tema">
        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16 12a4 4 0 1 0-8 0 4 4 0 1 0 8 0M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
        </svg>
      </button>
      <!-- Botón principal (Lucide menu / x) -->
      <button id="fab-main" class="relative z-10 grid h-12 w-12 place-items-center rounded-full bg-brand-800 border border-brand-700 text-brand-300 shadow-lg hover:text-brand-50" aria-label="Menú de acciones">
        <svg class="fab-hamburger h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 5h16M4 12h16M4 19h16" />
        </svg>
        <svg class="fab-close h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M18 6 6 18M6 6l12 12" />
        </svg>
      </button>
    </div>
    <script is:inline>
    (function () {
      var fab = document.getElementById('mobile-fab');
      var fabMain = document.getElementById('fab-main');
      var fabTop = document.getElementById('fab-top');
      if (!fab || !fabMain) return;

      var holdTimer = null;
      var HOLD_MS = 200;
      var touchUsed = false;

      function closeFab() { fab.classList.remove('open'); }

      fabMain.addEventListener('touchstart', function (e) {
        e.preventDefault();
        touchUsed = true;
        // Si está abierto, cerrar inmediatamente
        if (fab.classList.contains('open')) {
          closeFab();
          return;
        }
        // Si está cerrado, esperar hold para abrir
        holdTimer = setTimeout(function () {
          fab.classList.add('open');
          holdTimer = null;
        }, HOLD_MS);
      }, { passive: false });

      fabMain.addEventListener('touchend', function () {
        if (holdTimer) { clearTimeout(holdTimer); holdTimer = null; }
      });

      fabMain.addEventListener('touchcancel', function () {
        if (holdTimer) { clearTimeout(holdTimer); holdTimer = null; }
      });

      // Fallback click solo para mouse (desktop testing)
      fabMain.addEventListener('click', function () {
        if (touchUsed) { touchUsed = false; return; }
        fab.classList.toggle('open');
      });

      // Cerrar al tocar fuera
      document.addEventListener('click', function (e) {
        if (fab.classList.contains('open') && !fab.contains(e.target)) {
          closeFab();
        }
      });
      document.addEventListener('touchstart', function (e) {
        if (fab.classList.contains('open') && !fab.contains(e.target)) {
          closeFab();
        }
      });

      // Cerrar FAB automáticamente al hacer scroll
      var scrollTimer = null;
      window.addEventListener('scroll', function () {
        if (!fab.classList.contains('open')) return;
        if (scrollTimer) clearTimeout(scrollTimer);
        scrollTimer = setTimeout(closeFab, 400);
      }, { passive: true });

      // Cerrar FAB tras cualquier satélite
      fab.querySelectorAll('.fab-satellite').forEach(function (btn) {
        btn.addEventListener('click', function () {
          closeFab();
        });
      });

      // Ir arriba
      if (fabTop) fabTop.addEventListener('click', function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    })();
    </script>

    <main>
      <slot />
    </main>
    <footer class="mx-auto max-w-7xl px-4 pb-20 pt-0 md:px-6 md:pb-6">
      <div class="flex flex-col items-center gap-3 border-t border-brand-800 pt-6 md:flex-row md:justify-between md:gap-0">
        <div class="flex items-center gap-2">
          <img src="/favicon.svg" alt="DBZ" class="h-4 w-auto" />
          <span class="text-xs text-brand-500">© {new Date().getFullYear()} Daniel Bonifaz.</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-xs text-brand-500">Desarrollado por</span>
          <a href="https://cofoundy.dev/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-1.5 transition-opacity hover:opacity-80">
            <Image src={logoCofoundy} alt="Cofoundy" class="h-4 w-auto" />
            <span class="text-xs font-medium text-brand-400">Cofoundy</span>
          </a>
        </div>
      </div>
    </footer>
    <script>
      import Lenis from 'lenis';

      const lenis = new Lenis({
        duration: 1.2,
        easing: (t: number) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
      });

      function raf(time: number) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);
    </script>
  </body>
</html>
